<!DOCTYPE html>
<html lang="en">
<head>
    {% load static tailwind_tags %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noora's Ladies Wear - {% block title %}{% endblock %}</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    {% tailwind_css %}

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, .brand-font { font-family: 'Playfair Display', serif; }

        /* Smooth mobile menu transition */
        .mobile-menu { transition: max-height 0.3s ease-in-out; max-height: 0; overflow: hidden; }
        .mobile-menu.open { max-height: 600px; } /* Increased height to fit categories */

        /* Dropdown hover effect helpers */
        .dropdown-trigger:hover .dropdown-menu { display: block; }
    </style>
</head>
<body class="bg-white text-gray-800 flex flex-col min-h-screen" x-data="{ mobileMenuOpen: false, mobileSearchOpen: false }">

    <!-- HEADER -->
    <header class="bg-white border-b border-gray-100 sticky top-0 z-40 shadow-sm">
        <nav class="container mx-auto px-4 h-20 flex justify-between items-center">

            <!-- 1. LEFT: Mobile Menu Button & Search Trigger -->
            <div class="flex items-center md:hidden gap-4">
                <button @click="mobileMenuOpen = !mobileMenuOpen" class="text-gray-600 focus:outline-none">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>
                <button @click="mobileSearchOpen = !mobileSearchOpen" class="text-gray-600 focus:outline-none">
                    <i class="fa-solid fa-magnifying-glass text-xl"></i>
                </button>
            </div>

            <!-- 2. CENTER/LEFT: Logo -->
            <div class="flex-shrink-0 flex items-center justify-center md:justify-start w-full md:w-auto absolute md:relative left-0 right-0 pointer-events-none md:pointer-events-auto">
                <a href="{% url 'home' %}" class="pointer-events-auto">
                    <img src="{% static 'logo.png' %}" alt="Noora's Logo" class="h-14 md:h-16 w-auto">
                </a>
            </div>

            <!-- 3. CENTER: Desktop Search Bar -->
            <div class="hidden md:flex flex-1 max-w-md mx-8">
                <form action="{% url 'product_search' %}" method="GET" class="relative w-full">
                    <input type="text" name="q" placeholder="Search for kurtis, tops..."
                           class="w-full bg-gray-50 border border-gray-200 rounded-full py-2.5 pl-5 pr-12 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black transition">
                    <button type="submit" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-black">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </form>
            </div>

            <!-- 4. RIGHT: Icons & Navigation -->
            <div class="flex items-center space-x-6 z-10">

                <!-- Desktop Navigation Links (THE NEW PART) -->
                <div class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-600">

                    <!-- Featured Link -->
                    <a href="{% url 'home' %}#featured" class="hover:text-black transition tracking-wide relative group">
                        FEATURED
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>

                    <!-- Categories Dropdown -->
                    <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                        <button class="flex items-center gap-1 hover:text-black transition tracking-wide focus:outline-none h-full py-2">
                            <span>CATEGORIES</span>
                            <i class="fa-solid fa-chevron-down text-[10px] transition-transform duration-200" :class="open ? 'rotate-180' : ''"></i>
                        </button>

                        <!-- Dropdown Panel -->
                        <div x-show="open"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 translate-y-1"
                             x-transition:enter-end="opacity-100 translate-y-0"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 translate-y-0"
                             x-transition:leave-end="opacity-0 translate-y-1"
                             class="absolute left-1/2 -translate-x-1/2 top-full mt-0 w-56 bg-white border border-gray-100 rounded-md shadow-lg py-2 z-50">

                            <a href="{% url 'category_detail' 'western-wears' %}" class="block px-5 py-3 text-gray-600 hover:bg-gray-50 hover:text-black transition">Western Wears</a>
                            <a href="{% url 'category_detail' 'party-wears' %}" class="block px-5 py-3 text-gray-600 hover:bg-gray-50 hover:text-black transition">Party Wears</a>
                            <a href="{% url 'category_detail' 'casual-wears' %}" class="block px-5 py-3 text-gray-600 hover:bg-gray-50 hover:text-black transition">Casual Wears</a>
                            <div class="border-t border-gray-100 my-1"></div>
                            <a href="{% url 'category_detail' 'premium-section' %}" class="block px-5 py-3 text-amber-700 font-semibold hover:bg-amber-50 transition">
                                <i class="fa-solid fa-gem mr-2 text-xs"></i>Premium Section
                            </a>
                        </div>
                    </div>

                    <!-- About Link -->
                    <a href="#" class="hover:text-black transition tracking-wide relative group">
                        ABOUT
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-black transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </div>

                <!-- Divider -->
                <div class="h-6 w-px bg-gray-200 hidden md:block"></div>

                <!-- Cart Icon -->
                <a href="{% url 'cart_detail' %}" class="relative text-gray-700 hover:text-black transition" title="Cart">
                    <i class="fa-solid fa-bag-shopping text-xl"></i>
                    {% if request.session.cart|length > 0 %}
                    <span class="absolute -top-1.5 -right-1.5 bg-black text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center">
                        {{ request.session.cart|length }}
                    </span>
                    {% endif %}
                </a>

                <!-- User Account (Desktop) -->
                <div class="hidden md:block relative" x-data="{ userDropdown: false }">
                    {% if user.is_authenticated %}
                        <button @click="userDropdown = !userDropdown" class="flex items-center gap-2 text-sm font-medium hover:text-black transition">
                            <span>{{ user.first_name|default:user.username }}</span>
                            <i class="fa-solid fa-chevron-down text-xs"></i>
                        </button>
                        <!-- Dropdown -->
                        <div x-show="userDropdown" @click.away="userDropdown = false"
                             class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 border border-gray-100"
                             style="display: none;">
                            <a href="{% url 'my_orders' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">My Orders</a>
                            <form action="{% url 'logout' %}" method="POST" class="border-t border-gray-100">
                                {% csrf_token %}
                                <button type="submit" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50">Logout</button>
                            </form>
                        </div>
                    {% else %}
                        <a href="{% url 'login' %}" class="text-sm font-medium hover:text-black transition">Login</a>
                    {% endif %}
                </div>
            </div>
        </nav>

        <!-- MOBILE SEARCH BAR (Toggles Open) -->
        <div x-show="mobileSearchOpen" class="md:hidden px-4 pb-4 border-b border-gray-100 bg-white" style="display: none;">
            <form action="{% url 'product_search' %}" method="GET" class="relative w-full">
                <input type="text" name="q" placeholder="Search products..."
                       class="w-full bg-gray-50 border border-gray-200 rounded-lg py-2 px-4 text-sm focus:outline-none focus:border-black">
                <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </form>
        </div>

        <!-- MOBILE MENU (Drawer) -->
        <div :class="mobileMenuOpen ? 'open' : ''" class="mobile-menu bg-white md:hidden border-b border-gray-100">
            <div class="px-4 py-2 space-y-1">

                <!-- Added @click="mobileMenuOpen = false" to ALL links -->

                <a href="{% url 'home' %}" @click="mobileMenuOpen = false" class="block py-3 text-base font-bold text-gray-900 border-b border-gray-50">HOME</a>

                <a href="{% url 'home' %}#featured" @click="mobileMenuOpen = false" class="block py-3 text-base font-medium text-gray-700 border-b border-gray-50">Featured Collection</a>

                <div class="py-2">
                    <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 mt-2">Shop by Category</p>
                    <a href="{% url 'category_detail' 'western-wears' %}" @click="mobileMenuOpen = false" class="block py-2 text-base font-medium text-gray-700 pl-2 hover:text-black">Western Wears</a>
                    <a href="{% url 'category_detail' 'party-wears' %}" @click="mobileMenuOpen = false" class="block py-2 text-base font-medium text-gray-700 pl-2 hover:text-black">Party Wears</a>
                    <a href="{% url 'category_detail' 'casual-wears' %}" @click="mobileMenuOpen = false" class="block py-2 text-base font-medium text-gray-700 pl-2 hover:text-black">Casual Wears</a>
                    <a href="{% url 'category_detail' 'premium-section' %}" @click="mobileMenuOpen = false" class="block py-2 text-base font-medium text-amber-700 pl-2">Premium Section</a>
                </div>

                <div class="border-t border-gray-100 my-2"></div>

                {% if user.is_authenticated %}
                    <a href="{% url 'my_orders' %}" @click="mobileMenuOpen = false" class="block py-3 text-base font-medium text-gray-700">My Orders</a>
                    <div class="py-3 flex justify-between items-center">
                        <p class="text-sm text-gray-500">Hi, {{ user.first_name|default:user.username }}</p>
                        <form action="{% url 'logout' %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" class="text-red-600 font-medium text-sm border border-red-200 px-3 py-1 rounded-full">Log Out</button>
                        </form>
                    </div>
                {% else %}
                    <a href="{% url 'login' %}" @click="mobileMenuOpen = false" class="block py-3 text-base font-bold text-center text-white bg-black rounded mt-4 mb-2">LOGIN / REGISTER</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow">
        {% if messages %}
        <div class="container mx-auto px-4 mt-4">
            {% for message in messages %}
            <div class="p-4 rounded-md mb-4 text-sm font-medium
                {% if message.tags == 'success' %} bg-green-50 text-green-800 border border-green-100
                {% elif message.tags == 'error' %} bg-red-50 text-red-800 border border-red-100
                {% elif message.tags == 'warning' %} bg-yellow-50 text-yellow-800 border border-yellow-100
                {% else %} bg-blue-50 text-blue-800 border border-blue-100 {% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <!-- FOOTER (Ultra Minimal & Compact) -->
    <footer class="bg-gray-900 text-white py-10 mt-auto">
        <div class="container mx-auto px-6 text-center">

            <!-- 1. Brand Identity -->
            <div class="mb-6">
                <h2 class="text-2xl brand-font tracking-widest text-white mb-2">NOORA'S</h2>
                <p class="text-gray-500 text-[10px] tracking-[0.2em] uppercase">
                    Grace • Comfort • Culture
                </p>
            </div>

            <!-- 2. Social Media Icons (Compact) -->
            <div class="flex justify-center space-x-8 mb-8">
                <a href="#" class="text-gray-400 hover:text-white transition transform hover:scale-110 duration-300">
                    <i class="fa-brands fa-instagram text-xl"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-white transition transform hover:scale-110 duration-300">
                    <i class="fa-brands fa-facebook-f text-xl"></i>
                </a>
                <a href="#" class="text-gray-400 hover:text-white transition transform hover:scale-110 duration-300">
                    <i class="fa-brands fa-whatsapp text-xl"></i>
                </a>

            </div>

            <!-- 3. Copyright & Legal (Subtle) -->
            <div class="border-t border-gray-800 pt-6">
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-[10px] text-gray-600">
                    <p>&copy; 2025 Noora's Ladies Wear. All Rights Reserved.</p>
                    <span class="hidden md:block">•</span>
                    <div class="flex space-x-4">
                        <a href="#" class="hover:text-gray-400 transition">Privacy Policy</a>
                        <a href="#" class="hover:text-gray-400 transition">Terms of Service</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>